# Завдання 2 — Порівняння HyperLogLog із точним підрахунком унікальних елементів

Ця частина проєкту присвячена порівнянню:

- точного підрахунку унікальних IP-адрес за допомогою `set`;
- наближеної оцінки кількості унікальних IP-адрес за допомогою структури **HyperLogLog**.

---

## Файл

- `hll_vs_exact.py` — основний скрипт із реалізацією HyperLogLog, завантаженням лог-файлу та порівнянням методів.

> Файл логів `lms-stage-access.log` лежать **локально** в цій же папці, але **не** додається в репозиторій (великий розмір).

---

## Реалізований функціонал

### 1. Завантаження даних з лог-файлу

Функція:

```python
load_ips_from_log(path: str) -> List[str]
```

- читає текстовий лог-файл `lms-stage-access.log`;
- за допомогою регулярного виразу знаходить IPv4-адресу в кожному рядку;
- некоректні рядки (без IP) пропускає;
- повертає список IP-адрес.

Це відповідає вимозі:  
*«Метод завантаження даних обробляє лог-файл, ігноруючи некоректні рядки»*.

---

### 2. Точний підрахунок унікальних IP-адрес

Функція:

```python
exact_unique_count(ips: Iterable[str]) -> int
```

- використовує структуру даних `set`;
- повертає **точну** кількість унікальних IP-адрес.

Функція-обгортка `measure_exact(ips)`:

- заміряє час виконання за допомогою `time.perf_counter()`;
- повертає кортеж `(count, elapsed_seconds)`.

---

### 3. Наближений підрахунок за допомогою HyperLogLog

Клас:

```python
class HyperLogLog:
    def __init__(self, p: int = 14): ...
    def add(self, value): ...
    def count(self) -> float: ...
```

- `p` — кількість бітів, що визначають кількість регістрів (`m = 2**p`);
- використовується 64-бітний хеш (на основі `hashlib.sha1`);
- кожен елемент оновлює відповідний регістр значенням `rho(w)` (кількість початкових нулів у частині хешу);
- метод `count()`:
  - обчислює сиру оцінку кардинальності;
  - застосовує стандартну **alpha_m**-корекцію;
  - враховує випадки:
    - малої кількості елементів (лініаризація),
    - дуже великої кардинальності (додаткова корекція).

Функція-обгортка `measure_hll(ips, p)`:

- створює екземпляр `HyperLogLog`;
- додає всі IP-адреси;
- повертає кортеж `(estimate, elapsed_seconds)`.

---

### 4. Виведення результатів порівняння

Функція:

```python
print_comparison_table(exact_cnt, exact_time, hll_cnt, hll_time)
```

- виводить результати у вигляді таблиці:

  - точний підрахунок: кількість унікальних елементів + час виконання;
  - HyperLogLog: наближена кількість + час виконання;
  - відносна похибка HyperLogLog у %.

Приклад можливого виводу (цифри умовні):

```text
Загальна кількість рядків з IP: 250000

Результати порівняння:
Метод                     Унікальні елементи   Час виконання (сек.)
-------------------------------------------------------------------
Точний підрахунок                    100000.0                  0.4523
HyperLogLog                           99652.0                  0.1012

Відносна похибка HyperLogLog: 0.3480%
```

Це відповідає вимозі: *«Результати порівняння представлені у вигляді таблиці»*.

---

## Як запустити

1. Поклади файл `lms-stage-access.log` в папку `task_2_hyper_log_log/`.
2. З кореня репозиторію виконай:

```bash
cd task_2_hyper_log_log
python3 hll_vs_exact.py
```

Скрипт:

- завантажить IP-адреси;
- виконає точний підрахунок через `set`;
- виконає наближений підрахунок через `HyperLogLog`;
- виведе порівняльну таблицю та похибку.

---

## Призначення завдання

Завдання демонструє:

- різницю між точним та наближеним підрахунком унікальних елементів;
- застосування HyperLogLog для великих наборів даних, де важливі:
  - швидкість,
  - економія пам’яті,
  - прийнятна похибка;
- використання метрик часу виконання для оцінки продуктивності алгоритмів.